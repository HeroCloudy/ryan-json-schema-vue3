(function(d,n){typeof exports=="object"&&typeof module<"u"?n(exports,require("vue"),require("element-plus")):typeof define=="function"&&define.amd?define(["exports","vue","element-plus"],n):(d=typeof globalThis<"u"?globalThis:d||self,n(d.form={},d.Vue,d.elementPlus))})(this,function(d,n,u){"use strict";const $="ui:hidden",Q="ui:disabled",Z="ui:width",R="ui:options",E="ui:widget",B="ui:column";var f=(e=>(e.SELECT="select",e.RADIO="radio",e.CHECKBOX="checkbox",e.SWITCH="switch",e.INPUT="input",e.TEXTAREA="textarea",e))(f||{}),N=(e=>(e.STRING="string",e.NUMBER="number",e.ARRAY="array",e.BOOLEAN="boolean",e))(N||{});const W={schema:{type:Object,required:!0},uiSchema:{type:Object,required:!1,default:()=>({})}},v=(e,t)=>{if(t==null)return e;if(t.length===0)return{...e,properties:{}};const o={};return t.forEach(r=>{e.properties[r]&&(o[r]=e.properties[r])}),{...e,properties:o}};class y{constructor(t,o,r){this.schema=t,this.uiSchema=o,this.model=r,this.commonProps=this.initCommonProps(),this.prop=this.schema.prop}initCommonProps(){const t={...this.uiSchema[R]||{}};return t.disabled=this.uiSchema[Q]===!0,t.placeholder=t.placeholder||this.schema.description,t}}function ee(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!n.isVNode(e)}class L extends y{render(){let t;const{oneOf:o}=this.schema;return n.createVNode(u.ElRadioGroup,n.mergeProps(this.commonProps,{modelValue:this.model[this.prop],"onUpdate:modelValue":r=>this.model[this.prop]=r}),ee(t=o.map(r=>n.createVNode(u.ElRadio,{label:r.const},{default:()=>[r.title]})))?t:{default:()=>[t]})}}function te(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!n.isVNode(e)}class D extends y{render(){let t;const{oneOf:o,anyOf:r}=this.schema,s=!!r,i=o||r||[];return n.createVNode(u.ElSelect,n.mergeProps(this.commonProps,{modelValue:this.model[this.prop],"onUpdate:modelValue":c=>this.model[this.prop]=c,style:{width:"100%"},multiple:s,clearable:!0}),te(t=i.map(c=>n.createVNode(u.ElOption,{label:c.title,value:c.const},null)))?t:{default:()=>[t]})}}class H extends y{render(){let{format:t}=this.schema;const{type:o}=this.schema;return o===N.ARRAY&&(t+="range",this.commonProps["range-separator"]=this.commonProps["range-separator"]||"-"),n.createVNode(u.ElDatePicker,n.mergeProps(this.commonProps,{modelValue:this.model[this.prop],"onUpdate:modelValue":r=>this.model[this.prop]=r,type:t,clearable:!0}),null)}}class re extends y{render(){const t=this.uiSchema[E]==="textarea"?"textarea":"text";return n.createVNode(u.ElInput,n.mergeProps(this.commonProps,{type:t,modelValue:this.model[this.prop],"onUpdate:modelValue":o=>this.model[this.prop]=o,clearable:!0}),null)}}class oe extends y{render(){return n.createVNode(u.ElInputNumber,n.mergeProps({style:{width:"100%"}},this.commonProps,{modelValue:this.model[this.prop],"onUpdate:modelValue":t=>this.model[this.prop]=t}),null)}}class J extends y{render(){return n.createVNode(u.ElSwitch,n.mergeProps(this.commonProps,{modelValue:this.model[this.prop],"onUpdate:modelValue":t=>this.model[this.prop]=t}),null)}}function ne(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!n.isVNode(e)}class se extends y{render(){let t;const{anyOf:o=[]}=this.schema;return n.createVNode(u.ElCheckboxGroup,n.mergeProps(this.commonProps,{modelValue:this.model[this.prop],"onUpdate:modelValue":r=>this.model[this.prop]=r}),ne(t=o.map(r=>n.createVNode(u.ElCheckbox,{label:r.const},{default:()=>[r.title]})))?t:{default:()=>[t]})}}function ie(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!n.isVNode(e)}const ce=(e,t={},o,r,s,i)=>{let c;const l=e.prop;if(t[$])return null;const p={...t,[E]:t[E],[R]:{...t[R]||{},onKeyup:a=>{a.code==="Enter"&&i.enter(a)},onChange:a=>i.change(l,a)}};e.prop==="startTime"&&console.log(e);const m={item:e,uiItem:p,model:o},h=()=>{if(r&&r[l])return()=>r[l](o);switch(e.type){case N.STRING:return G(m);case N.NUMBER:return ae(m);case N.BOOLEAN:return le(m);case N.ARRAY:return de(m)}return G(m)},b=t[B]||1,C=(t[R]||{}).labelWidth||"auto";return n.createVNode(u.ElCol,{span:s*b},{default:()=>[n.createVNode(u.ElFormItem,{label:e.description,prop:l,"label-width":C},ie(c=h())?c:{default:()=>[c]})]})},I=(e="不支持该类型")=>n.createVNode("div",null,[e]),G=e=>{const{model:t,item:o,uiItem:r}=e;if(o.oneOf){const s=r[E]||f.SELECT;return s===f.RADIO?new L(o,r,t).render():s===f.SELECT?new D(o,r,t).render():I()}if(o.format&&(o.format==="date"||o.format==="datetime")){const s=r["ui:options"]||{};return console.log("重新渲染date-picker",o.prop,s["disabled-date"]),new H(o,r,t).render()}return new re(o,r,t).render()},ae=e=>{const{model:t,item:o,uiItem:r}=e;return r&&r[E]===f.SWITCH?new J(o,r,t).render():new oe(o,r,t).render()},le=e=>{const{model:t,item:o,uiItem:r}=e,s=r[E]||f.SWITCH,i=[{const:!0,title:"是"},{const:!1,title:"否"}];return o.oneOf=o.oneOf?o.oneOf:i,s===f.SWITCH?new J(o,r,t).render():s===f.RADIO?new L(o,r,t).render():s===f.SELECT?new D(o,r,t).render():I()},de=e=>{const{model:t,item:o,uiItem:r}=e;if(o.anyOf){const s=r[E]||"select";if(s===f.SELECT)return new D(o,r,t).render();if(s===f.CHECKBOX)return new se(o,r,t).render()}return o.format&&(o.format==="date"||o.format==="datetime")?new H(o,r,t).render():I()},pe=(e={},t)=>{const o={...e},{properties:r}=t,{required:s=[]}=t;return s.forEach(i=>{if(r[i]){const c=r[i].prop||i;K(o,c,X(r[i].description))}}),Object.keys(r).forEach(i=>{const c=r[i],l=c.prop||i;c.required&&s.findIndex(p=>p===l)<0&&K(o,l,X(r[i].description))}),o},K=(e,t,o)=>{e[t]||(e[t]=[]),e[t].push(o)},X=e=>({required:!0,message:`${e}不能为空`,trigger:"blur"}),T={...W,model:{type:Object,required:!0},column:{type:Number,required:!1,default:3},rules:{type:Object,required:!1,default:()=>({})}},q={...T,fields:{type:Array,required:!1}},M={...W,model:{type:Object,required:!0},column:{type:Number,required:!1,default:3},size:{type:String,required:!1,default:"default"},border:{type:Boolean,required:!1,default:!0}},F={...M,fields:{type:Array,required:!1}},Y={...q,...F,readMode:{type:Boolean,required:!1,default:!1}};function me(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!n.isVNode(e)}const x="ry-json-form",O=n.defineComponent({name:x,props:T,setup(e,t){const o=n.ref();let r=n.reactive(e.model);const s=()=>{o.value&&o.value.resetFields()},i=a=>{o.value&&o.value.validate(a)};t.expose({reset:s,validate:i});let c=24/e.column;n.watchEffect(()=>{r=n.reactive(e.model),c=24/e.column});const m={change:(a,g)=>{t.emit("data-change",a,g,r)},enter:a=>{t.emit("enter-up",a,e.model)}},h=()=>{o.value&&o.value.clearValidate();const{properties:a}=e.schema,g=[];return Object.keys(a).forEach(A=>{const w=a[A];w.prop=w.prop||A;const k=e.uiSchema[A],_=ce(w,k,e.model,t.slots,c,m);_&&g.push(_)}),g},b=n.computed(()=>{const{schema:a,rules:g}=e;return pe(g,a)}),C=a=>{a&&(a.stopPropagation&&a.stopPropagation(),a.preventDefault&&a.preventDefault())};return()=>{let a;const{schema:g,uiSchema:A,model:w,column:k,rules:_,...Ee}=e;return n.createVNode("div",{className:x},[n.createVNode(u.ElForm,n.mergeProps(Ee,{ref:o,model:r,rules:b.value,labelWidth:"auto",onSubmit:C}),{default:()=>[n.createVNode(u.ElRow,{gutter:20},me(a=h())?a:{default:()=>[a]})]})])}}});O.install=e=>{e.component(O.name,O)};const z=e=>({reset:()=>{const r=e();r&&r.reset()},validate:r=>{const s=e();s&&s.validate(r)}}),U=(e,t)=>({onDataChange:(s,i)=>{e.emit("data-change",s,i,t)},onEnterUp:s=>{e.emit("enter-up",s,t)}}),S=n.defineComponent({name:"ry-pro-form",props:q,setup(e,t){const o=n.ref(),{reset:r,validate:s}=z(()=>o.value);t.expose({reset:r,validate:s});const i=n.computed(()=>{if(!e.fields)return e.schema;const l={};return e.schema&&e.schema.properties&&e.fields.forEach(p=>{e.schema.properties[p]&&(l[p]=e.schema.properties[p])}),{...e.schema,properties:l}}),c=n.computed(()=>{const l={...e};return delete l.fields,l});return()=>n.createVNode(O,n.mergeProps({ref:o},c.value,{schema:i.value},U(t,e.model)),t.slots)}});S.install=e=>{e.component(S.name,S)};const ue=(e,t={},o,r)=>{if(t[$]===!0)return null;const s=e.prop,i=()=>{const l=o[s];if(e.oneOf){const p=e.oneOf.find(m=>m.const===l);return p?p.title:l}return e.anyOf?typeof l=="string"?l.split(",").map(m=>{var b;const h=(b=e.anyOf)==null?void 0:b.find(C=>C.const===m);return h?h.title:m}).join(","):l.map(p=>{var h;const m=(h=e.anyOf)==null?void 0:h.find(b=>b.const===p);return m?m.title:p}).join(","):l},c=t[R]||{};return n.createVNode(n.resolveComponent("el-descriptions-item"),n.mergeProps(c,{span:t[B]||1,width:t[Z]||100,label:e.description||""}),{default:()=>[r[s]?r[s](o):i()]})};function fe(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!n.isVNode(e)}const V=n.defineComponent({name:"ry-json-description",props:M,setup(e,t){const o=()=>{const{properties:r}=e.schema,s=[];return Object.keys(r).forEach(i=>{const c=r[i];c.prop=c.prop||i;const l=e.uiSchema[i],p=ue(c,l,e.model,t.slots);p&&s.push(p)}),s};return()=>{let r;const{column:s}=e;return n.createVNode(n.resolveComponent("el-descriptions"),n.mergeProps(t.attrs,{column:s,border:!0}),fe(r=o())?r:{default:()=>[r]})}}});V.install=e=>{e.component(V.name,V)};const P=n.defineComponent({name:"ry-pro-description",props:F,setup(e,t){const o=t.attrs,r=n.computed(()=>v(e.schema,e.fields)),s=n.computed(()=>{const i={...e};return delete i.fields,i});return()=>n.createVNode(V,n.mergeProps(o,s.value,{schema:r.value}),t.slots)}});P.install=e=>{e.component(P.name,P)};const j=n.defineComponent({name:"ry-json-form-description",props:Y,setup(e,t){const o=n.ref(),r=()=>{o.value&&o.value.reset()},s=i=>{o.value&&o.value.validate(i)};return t.expose({reset:r,validate:s}),()=>{const{readMode:i,...c}=e;return i?n.createVNode(P,c,{default:()=>[n.createTextVNode("description")],...t.slots}):n.createVNode(S,n.mergeProps({ref:o},c,U(t,e.model)),{default:()=>[n.createTextVNode("form")],...t.slots})}}});j.install=e=>{e.component(j.name,j)};const he=[O,S,V,P,j],be={install:e=>{he.forEach(t=>{e.component(t.name,t)})}};d.JsonDescription=V,d.JsonForm=O,d.JsonFormDescription=j,d.ProDescription=P,d.ProForm=S,d.basicDescriptionProps=M,d.basicFormProps=T,d.bindEvent=U,d.bindMethod=z,d.default=be,d.jsonFormDescriptionProps=Y,d.proDescriptionProps=F,d.proFormProps=q,Object.defineProperties(d,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
